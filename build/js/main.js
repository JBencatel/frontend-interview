"use strict";function _createForOfIteratorHelper(e,r){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||r&&e&&"number"==typeof e.length){a&&(e=a);var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,l=!0,i=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return l=e.done,e},e:function(e){i=!0,n=e},f:function(){try{l||null==a.return||a.return()}finally{if(i)throw n}}}}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var a=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(a="Object"===a&&e.constructor?e.constructor.name:a)||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var a=0,t=new Array(r);a<r;a++)t[a]=e[a];return t}var gameAreaDisplay,statsAreaDisplay,interval,players={1:{icon:"X",score:0,display:{score:null,turn:null,victoriesPercentage:null}},2:{icon:"O",score:0,display:{score:null,turn:null,victoriesPercentage:null}}},gameNrRowsPerColumns=3,gridState=[],matchFirstPlayer=1,currentPlayer=1,matchTime={value:0,display:null},gameTime={value:0,display:null},playedMatches=0;function handleGridSelection(e){var r=e.target,e=r.getAttribute("data-grid-option");e!==gameNrRowsPerColumns&&(gameNrRowsPerColumns=e,document.querySelector(".grid-option-btn.selected").classList.remove("selected"),r.classList.add("selected"))}function handleGameStart(e){setPlayersIcons(e.target.getAttribute("data-marker")),gameAreaDisplay.gameStart.wholeDisplay.classList.add("on-going-game"),gameAreaDisplay.gameArea.classList.add("on-going-game"),prepareGridViewElements(),gameAreaDisplay.gridSelectionButtons.forEach(function(e){return e.classList.add("disabled")}),matchFirstPlayer=1,handleMatchStart()}function setPlayersIcons(e){addPlayerMarkerElement(1,players[1].icon=e),players[2].icon="X"===e?"O":"X",addPlayerMarkerElement(2,players[2].icon)}function prepareGridViewElements(){var e=document.getElementById("grid-container");e.style.gridTemplateColumns="repeat(".concat(gameNrRowsPerColumns,", 1fr)"),e.style.gridTemplateRows="repeat(".concat(gameNrRowsPerColumns,", 1fr)");for(var r=0;r<gameNrRowsPerColumns;r++)for(var a=0;a<gameNrRowsPerColumns;a++){var t=createGridCellElement(r,a);e.appendChild(t)}gameAreaDisplay.cells=document.querySelectorAll(".cell"),gameAreaDisplay.cells.forEach(function(e){return e.addEventListener("click",handleCellClick)})}function createGridCellElement(e,r){var a=document.createElement("div");return a.setAttribute("class","cell"),a.setAttribute("data-row",e),a.setAttribute("data-col",r),a.setAttribute("id","cell"+e+r),a}function addPlayerMarkerElement(e,r){r=createPlayerMarkerElement(e,r);document.getElementById("player-".concat(e,"-score")).appendChild(r),players[e].display.turn=document.querySelector("#player-".concat(e,"-turn-marker"))}function createPlayerMarkerElement(e,r){var a=document.createElement("img");return a.setAttribute("src","images/".concat(r,"_dark.svg")),a.setAttribute("class","turn"),a.setAttribute("alt",r+" marker"),a.setAttribute("id","player-".concat(e,"-turn-marker")),a}function handleMatchStart(){prepareGridStateMatrix(),gameAreaDisplay.cells.forEach(function(e){e.innerHTML="",e.classList.remove("disabled")}),players[currentPlayer=matchFirstPlayer].display.turn.classList.add("active"),setTimer()}function prepareGridStateMatrix(){gridState=[];for(var e=0;e<gameNrRowsPerColumns;e++){gridState.push([]);for(var r=0;r<gameNrRowsPerColumns;r++)gridState[e].push(null)}}function setTimer(){interval=setInterval(function(){++matchTime.value,matchTime.display.innerHTML=parseTime(matchTime.value)},1e3)}function parseTime(e){var r=e%3600;return padTimeUnit(Math.floor(e/3600))+":"+padTimeUnit(Math.floor(r/60))+":"+padTimeUnit(r%=60)}function padTimeUnit(e){e+="";return e.length<2?"0"+e:e}function handleCellClick(e){var r=e.target,a=parseInt(r.getAttribute("data-row")),e=parseInt(r.getAttribute("data-col"));null===gridState[a][e]&&handleCellPlayed(r,a,e)}function handleCellPlayed(e,r,a){gridState[r][a]=currentPlayer;var t=players[currentPlayer].icon+"_dark";e.innerHTML='<img src="images/'.concat(t,'.svg" alt="x icon" />'),e.classList.add("disabled"),validateTurnResult(r,a)}function validateTurnResult(e,r){for(var a=0,t=Object.values({horizontal:{rowChange:0,colChange:1},vertical:{rowChange:1,colChange:0},diagonal1:{rowChange:1,colChange:1},diagonal2:{rowChange:1,colChange:-1}});a<t.length;a++){var n=t[a];if(isWinningSet(e,r,n.rowChange,n.colChange))return}gridState.flat().includes(null)?toggleActivePlayer():handleMatchEnd("Match ended in a draw!")}function isWinningSet(e,r,a,t){var n=[];return isCellFilled(e+a,r+t)&&(n.push({row:e+a,col:r+t}),isCellFilled(e+2*a,r+2*t)&&n.push({row:e+2*a,col:r+2*t})),isCellFilled(e-a,r-t)&&(n.push({row:e-a,col:r-t}),isCellFilled(e-2*a,r-2*t)&&n.push({row:e-2*a,col:r-2*t})),!(2!==n.length||!doesCellHaveCurrentUserMarker(n[0].row,n[0].col)||!doesCellHaveCurrentUserMarker(n[1].row,n[1].col))&&(n.push({row:e,col:r}),handleMatchWin(n),!0)}function isCellFilled(e,r){return gridState[e]&&gridState[e][r]}function doesCellHaveCurrentUserMarker(e,r){return gridState[e][r]===currentPlayer}function handleMatchWin(e){updatePlayedMatches(),updateScores(),updateGameTime(),highlightVictoryLines(e),handleMatchEnd("Player ".concat(currentPlayer," has won!")),hasGameEnded()&&scrollToStatsSection()}function updatePlayedMatches(){statsAreaDisplay.matches[playedMatches].classList.add("active"),statsAreaDisplay.winners[playedMatches].innerHTML="P"+currentPlayer,++playedMatches}function updateScores(){updateMatchWinnerScore();var e=Math.round(100*players[1].score/playedMatches),r=100-e;updatePlayerGameVictoriesStats(players[1],e),updatePlayerGameVictoriesStats(players[2],r)}function updateMatchWinnerScore(){++players[currentPlayer].score,players[currentPlayer].display.score.innerHTML=players[currentPlayer].score}function updatePlayerGameVictoriesStats(e,r){e.display.victoriesPercentage.innerHTML=r+"%";var a="";0<playedMatches&&(50==r?a="draw":50<r?a="winning":r<50&&(a="losing")),e.display.victoriesPercentage.classList.remove("winning","losing","draw"),""!==a&&e.display.victoriesPercentage.classList.add(a)}function updateGameTime(){gameTime.value+=matchTime.value,gameTime.display.innerHTML=parseTime(gameTime.value)}function highlightVictoryLines(e){var r,a=_createForOfIteratorHelper(e);try{for(a.s();!(r=a.n()).done;){var t=r.value,n=players[currentPlayer].icon+"_bright";document.getElementById("cell"+t.row+t.col).innerHTML='<img src="images/'.concat(n,'.svg" alt="x icon" />')}}catch(e){a.e(e)}finally{a.f()}}function handleMatchEnd(e){clearInterval(interval),gameAreaDisplay.matchOver.message.innerHTML=e,gameAreaDisplay.matchOver.display.classList.add("active"),players[currentPlayer].display.turn.classList.remove("active")}function toggleActivePlayer(){var e=1===currentPlayer?2:1;players[e].display.turn.classList.add("active"),players[currentPlayer].display.turn.classList.remove("active"),currentPlayer=e}function hasGameEnded(){return 5===players[1].score||5===players[2].score}function scrollToStatsSection(){document.getElementById("stats-section").scrollIntoView()}function handleStartOver(){gameAreaDisplay.matchOver.display.classList.remove("active"),matchTime.value=0,matchTime.display.innerHTML="00:00:00",hasGameEnded()?resetGame():(matchFirstPlayer=1===matchFirstPlayer?2:1,handleMatchStart())}function resetGame(){resetStatsAreaValues(),resetGameAreaValues()}function resetGameAreaValues(){resetPlayerValues(1),resetPlayerValues(2),gameAreaDisplay.gameStart.wholeDisplay.classList.remove("on-going-game"),gameAreaDisplay.gameArea.classList.remove("on-going-game"),gameAreaDisplay.gameArea.innerHTML="",gameAreaDisplay.gridSelectionButtons.forEach(function(e){return e.classList.remove("disabled")})}function resetPlayerValues(e){var r=players[e];r.score=0,r.icon=null,r.display.score.innerHTML=0;e=document.getElementById("player-".concat(e,"-turn-marker"));e.parentNode.removeChild(e),updatePlayerGameVictoriesStats(r,0)}function resetStatsAreaValues(){playedMatches=0;var e,r=_createForOfIteratorHelper(statsAreaDisplay.matches);try{for(r.s();!(e=r.n()).done;)e.value.classList.remove("active")}catch(e){r.e(e)}finally{r.f()}var a,t=_createForOfIteratorHelper(statsAreaDisplay.winners);try{for(t.s();!(a=t.n()).done;)a.value.innerHTML=""}catch(e){t.e(e)}finally{t.f()}gameTime.value=0,gameTime.display.innerHTML="00:00:00"}window.onload=function(){players[1].display={score:document.querySelector("#player-1-score .victories"),victoriesPercentage:document.querySelector("#player-1-victories .value")},players[2].display={score:document.querySelector("#player-2-score .victories"),victoriesPercentage:document.querySelector("#player-2-victories .value")},matchTime.display=document.querySelector("#timer h2"),gameTime.display=document.querySelector("#total-time p"),gameAreaDisplay={gridSelectionButtons:document.querySelectorAll(".grid-option-btn"),gameStart:{wholeDisplay:document.querySelector("#game-start"),buttons:document.querySelectorAll("#game-start .marker")},gameArea:document.querySelector("#grid-container"),matchOver:{display:document.querySelector("#game-over"),message:document.querySelector("#game-over #game-result"),button:document.querySelector("#game-over #start-over-btn")}},statsAreaDisplay={matches:document.querySelectorAll(".game-match"),winners:document.querySelectorAll(".winner")},gameAreaDisplay.gridSelectionButtons.forEach(function(e){return e.addEventListener("click",handleGridSelection)}),gameAreaDisplay.gameStart.buttons.forEach(function(e){return e.addEventListener("click",handleGameStart)}),gameAreaDisplay.matchOver.button.addEventListener("click",handleStartOver)};